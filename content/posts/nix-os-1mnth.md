---
title: "1개월간의 NixOS 사용후기"
date: 2023-08-06T18:02:09+09:00
draft: false
---

# 삽질 기록

## Arch Linux

해당 리눅스 배포판을 사용했던 이유는 없고, 이전에 사용해봤었던 리눅스 배포판 중 그래도
오랬동안 사용했었던 배포판이라 사용했다. 그리고 인터넷 리소스들 중에 타일 기반의 윈도우
매니저와 아치 리눅스를 같이 사용하는 경우가 많기도 했었던 게 한몫 했었던 것 같다.

그 당시에는 그래도 이슈가 생기면 찾아볼 수 있는 시간이 있었으니까, 설치해야 하는 패키지와
환경설정을 [dotfiles](https://github.com/seungwoo-lee-518-at-proton-me/dotfiles) Github
레파지토리를 통해서 관리했었고, 몇번의 시행착오를 겪었더니 파일은 많지만 그래도 사용할 수는
있는 환경이 되었다.

그리곤, 쓸만 해진 것 같아서 사용하던 M1 Macbook 과 Lenovo 노트북을 중고로 팔고, HP Elitebook
으로 넘어갔다. M1 이 사용하긴 편했던 것 같지만, `x86_64` 환경과 더 멀어지게 되서, 사용할 때
불편한 부분들이 많았기 때문에 처분을 결정했다.

## Windows 환경 하에서 WSL 을 사용

HP Elitebook 을 구매하고, 몇달 초반은 윈도우 환경 하에서 WSL (Windows Subsystem for Linux) 를
설치해서 사용했다. 우분투 환경이였고, 이전에 사용했던 dotfiles 를 몇가지 수정해서 사용하는 방식으로
큰 문제 없이 사용했던 것 같다.

다만, 업그레이드 시 교체한 NVMe SSD 가 불량이여서 인식도 정상적으로 되지 않았던 것 같았고,
WSL 에서 CPU 부하가 생기는 작업을 하는 경우, Tiger Lake 노트북의 한계 때문에 간간히 프리징이 발생했는데
이게 참 여러모로 머리가 아팠다.

WSL 환경에서 CPU, Memory 점유하는 갯수를 조절해서 사용해보거나, 여러 시도를 해봤는데 프리징이 생기면
몇초간 노트북이 멈추는 현상을 계속 일으켰다. 중간중간에 `VM OS 설정이 문제인건가?` 싶어서 설정 변경하고
테스트해보고 지웠다 깔았다 해보면서, 설치해야 하는 패키지 설정도 그에 따라 변경되어야 하는 부분이 참 불편
했었다.

`그냥 밀고 Pop-OS 로 넘어가볼까` 라는 생각을 해보곤, 실제로 실행에 옮겨서 몇주정도 사용해보니 Gnome 의 깔끔한
UX 외에는 크게 장점은 없었던 것 같고, 하드웨어 가속 등의 문제는 그대로 해결되지 않은 체로 남아있는 것 같아서
다시 Windows 환경으로 돌아왔다.

### Home-Manager 을 사용해보자!

다시 윈도우 환경하의 WSL 환경으로 돌아와서, Ubuntu VM 위에 [Home Manager](https://github.com/nix-community/home-manager)
을 설치해서 사용해보기 시작했다. 우선 [NixOS](https://nixos.org/) 홈페이지에 들어가서, Nix 를 설치한 뒤에
[Home Manager](https://github.com/nix-community/home-manager) 를 설치하면 설치는 끝나기 때문에 크게 어렵진 않다.

이후 [Home Manager 공식문서](https://nix-community.github.io/home-manager/) 를 참고하여 Nix Expression 을 작성한 뒤에
`home-manager switch` 명령을 사용해서 환경을 바꿔주기만 하면 Configuration as Code 를 달성할 수 있다.

여기에서 크게 만족을 했고, 앞에서 사용했던 패키지 설치 쉘 스크립트를 Home-Manager 의 설정 코드로 변경하기 시작했는데
Host OS 가 Nix 가 아닌 다른 운영체제 (Ubuntu) 였다 보니, SystemD 등의 서비스 동작을 매끄럽게 할 수가 없다는 어려움이
존재하긴 했던 것 같았다.

## 삽질의 끝

그동안 바빴던 일도 지나가고, 금오일 밤이 찾아왔는데, 뭘 할까 고민해보던 찰나에 윈도우를 NixOS 로 옮기는 작업을 진행할까?
해서, 설치를 진행했다. Gnome 에디션을 설치해서, GUI 기반으로 설치를 지원하기 때문에 설치는 크게 어렵진 않았다.

그리고, 이전에 Home Manager 에서 사용하던 `/etc/nixos/configuration.nix` 파일로 옮긴 다음, `nixos-rebuild switch` 명령어를
통해서, 몇십분 만에 (물론 인터넷 속도가 빠른단 전재 하에) 마이그레이션까지 완료했고, 문서를 작성하는 현재까지 안정적으로
사용하고 있다.

이전에 했던 패키지 잘못 깔았을 때의 대처 방법이 뭘 들어내고 뭘 깔고 이게 아니라, 설정을 변경하거나, 재부팅을 해서 이전의 Generation
으로 부팅해서 돌아간 뒤에 다시 빌드하는 방식이 좀 불편하긴 해도 설정을 코드의 형태로 관리할 수 있고, 버저닝이 된다는 부분이
참 좋은 것 같다.

추가적으로, 매뉴얼에서 몇줄 추가 만으로 다른 리눅스 배포판에서 했던 하드웨어 가속이 해결되서 속이 뻥 뚫린 것 같다.

dotfiles 설정은 nix experssion 관련된 파일 몇가지와, Neovim 설정 외에는 모두 삭제했다.
